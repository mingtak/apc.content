<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
    xmlns:tal="http://xml.zope.org/namespaces/tal"
    xmlns:metal="http://xml.zope.org/namespaces/metal"
    xmlns:i18n="http://xml.zope.org/namespaces/i18n"
    lang="en"
    metal:use-macro="context/main_template/macros/master"
    i18n:domain="apc.content">
<body>
<metal:content-core fill-slot="content-core">
<metal:content-core define-macro="content-core"
                    tal:define="toc context/table_of_contents|nothing;">
<style>
label{
  margin: 0;      
}
</style>
<div style='display: flex;align-items: center'>
  <select id='period' style='margin-right: 15px'>
    <option value='107_1'>上學期</option>
    <option value='latest'>下學期</option>
  </select>
  <label>
    <input type='radio' value='study' name='mode'>
    到課率
  </label>
  <label style='margin: 0px 5px'>
    <input type='radio' value='lang' name='mode' checked>
    語系分析
  </label>
  <select id='selected_course'>
  </select>
  <input type='submit' id='send' style='margin-left: 5px'>
</div>
<br><br>
<div id='result'/>




<script>
$(function(){
  $('#selected_course').hide()

  $('input[type=radio]').change(function(){
    period = $('#period').val()

    if($(this).val() == 'study'){
      $.ajax({
        method: 'post',
        url: '${context/absolute_url}/show_chart',
        data: {search: 1, period: period},
        success: function(e){
          e = JSON.parse(e)
          $('#selected_course option').remove()
          e.forEach((i)=>{
              $('#selected_course').append("<option value=" + i.id +">" + i.title + "</option>")
              $('#selected_course').show()
          })
        }
      })
    }else{
       $('#selected_course').hide()
    }
  })
  $('#period').change(function(){
    if($('#selected_course').is(':visible')){
      $.ajax({
        method: 'post',
        url: '${context/absolute_url}/show_chart',
        data: {search: 1, period: $(this).val()},
        success: function(e){
          e = JSON.parse(e)
          $('#selected_course option').remove()
          e.forEach((i)=>{
              $('#selected_course').append("<option value=" + i.id +">" + i.title + "</option>")
              $('#selected_course').show()
          })
        }
      })
    }
  })

  $('#send').click(function(){
    mode = $('input[type=radio]:checked').val()
    period = $('#period').val()
    selected_course = $('#selected_course').val()

    $.ajax({
      method: 'post',
      url: '${context/absolute_url}/show_chart',
      data: {'mode': mode, 'period': period, selected_course: selected_course},
      success: function(e){
          $('#result').html(e)
      }
    })
  })
})

</script>
</metal:content-core>
</metal:content-core>

<metal:js fill-slot="style_slot">
<link href="/++plone++apc.content/c3.min.css" rel="stylesheet">
<script src="/++plone++apc.content/d3-5.4.0.min.js"></script>
<script src="/++plone++apc.content/c3.min.js"></script>
</metal:js>

</body>
</html>


